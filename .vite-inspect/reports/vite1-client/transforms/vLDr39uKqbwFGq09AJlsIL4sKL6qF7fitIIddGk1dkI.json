{
  "resolvedId": "C:/Users/.Freelancer/baotangnghethuat/src/hooks/usePreloadAssets.js",
  "transforms": [
    {
      "name": "vite:load-fallback",
      "result": "import { useCallback, useEffect, useState } from \"react\";\r\nimport useImageCache from \"./useImageCache\";\r\n\r\nconst CONCURRENT_LOADS = 4; // Number of concurrent image loads\r\nconst PRIORITY_THRESHOLD = 5; // Number of high priority images to load first\r\n\r\nexport default function usePreloadAssets(assetList = [], options = {}) {\r\n  const { preload, isLoaded: isCached } = useImageCache();\r\n  const [progress, setProgress] = useState(0);\r\n  const [done, setDone] = useState(false);\r\n  const [priorityDone, setPriorityDone] = useState(false);\r\n\r\n  const loadImage = useCallback(\r\n    async (src) => {\r\n      if (isCached(src)) return true;\r\n      try {\r\n        await preload(src);\r\n        return true;\r\n      } catch (error) {\r\n        console.error(`Failed to preload: ${src}`, error);\r\n        return false;\r\n      }\r\n    },\r\n    [preload, isCached]\r\n  );\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    let loaded = 0;\r\n\r\n    if (assetList.length === 0) {\r\n      setDone(true);\r\n      setProgress(100);\r\n      setPriorityDone(true);\r\n      return;\r\n    }\r\n\r\n    // Split assets into priority and regular\r\n    const priorityAssets = assetList.slice(0, PRIORITY_THRESHOLD);\r\n    const regularAssets = assetList.slice(PRIORITY_THRESHOLD);\r\n\r\n    // Load priority assets first\r\n    const loadPriorityAssets = async () => {\r\n      await Promise.all(priorityAssets.map((src) => loadImage(src)));\r\n      if (isMounted) {\r\n        setPriorityDone(true);\r\n        loaded = priorityAssets.length;\r\n        setProgress(Math.round((loaded / assetList.length) * 100));\r\n      }\r\n    };\r\n\r\n    // Load regular assets in chunks\r\n    const loadRegularAssets = async () => {\r\n      for (let i = 0; i < regularAssets.length; i += CONCURRENT_LOADS) {\r\n        const chunk = regularAssets.slice(i, i + CONCURRENT_LOADS);\r\n        await Promise.all(chunk.map((src) => loadImage(src)));\r\n        if (isMounted) {\r\n          loaded += chunk.length;\r\n          setProgress(Math.round((loaded / assetList.length) * 100));\r\n        }\r\n      }\r\n      if (isMounted) setDone(true);\r\n    };\r\n\r\n    // Start loading process\r\n    loadPriorityAssets().then(() => {\r\n      if (regularAssets.length > 0) {\r\n        loadRegularAssets();\r\n      } else {\r\n        setDone(true);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      isMounted = false;\r\n    };\r\n  }, [assetList, loadImage]);\r\n\r\n  return { progress, done, priorityDone };\r\n}\r\n",
      "start": 1749089002774,
      "end": 1749089003626,
      "sourcemaps": null
    },
    {
      "name": "vite:react-babel",
      "start": 1749089003626,
      "end": 1749089003626,
      "order": "pre"
    },
    {
      "name": "vite:esbuild",
      "start": 1749089003626,
      "end": 1749089003626,
      "order": "normal"
    },
    {
      "name": "vite:worker",
      "start": 1749089003627,
      "end": 1749089003627,
      "order": "normal-normal"
    },
    {
      "name": "vite:define",
      "start": 1749089003627,
      "end": 1749089003627,
      "order": "normal-normal"
    },
    {
      "name": "vite:build-html",
      "start": 1749089003627,
      "end": 1749089003627,
      "order": "normal-normal"
    },
    {
      "name": "vite:worker-import-meta-url",
      "start": 1749089003627,
      "end": 1749089003627,
      "order": "normal-normal"
    },
    {
      "name": "vite:asset-import-meta-url",
      "start": 1749089003627,
      "end": 1749089003627,
      "order": "normal-normal"
    },
    {
      "name": "vite:dynamic-import-vars",
      "start": 1749089003627,
      "end": 1749089003627,
      "order": "normal-normal"
    },
    {
      "name": "vite:import-glob",
      "start": 1749089003627,
      "end": 1749089003627,
      "order": "normal-normal"
    },
    {
      "name": "vite:build-import-analysis",
      "start": 1749089003627,
      "end": 1749089003628,
      "order": "normal-normal"
    },
    {
      "name": "vite:reporter",
      "start": 1749089003628,
      "end": 1749089003644,
      "order": "normal"
    }
  ]
}
